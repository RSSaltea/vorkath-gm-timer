<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Vorkath Grandmaster Timer</title>
  <link rel="icon" href="./src/icon1.png" type="image/png" />

  <script src="https://www.unpkg.com/alt1/dist/base/index.js"></script>
  <script src="https://www.unpkg.com/alt1/dist/ocr/index.js"></script>
  <script src="https://www.unpkg.com/alt1/dist/chatbox/index.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <link rel="stylesheet" href="https://runeapps.org/nis/nis.css" />
  <link rel="stylesheet" href="./src/css/nis.css?v=1.0" />
  <link rel="stylesheet" href="./src/css/style.css?v=2.4" />
</head>
<body class="nis">

  <div class="vgt-layout">

  <!-- Admin controls panel (admin, far left) -->
  <div class="vgt-admin-controls-panel" id="admin-controls-panel" style="display:none;">
    <div class="vgt-ac-header"><span>Controls</span></div>

    <div class="vgt-ac-section">
      <div class="vgt-ac-label">Session</div>
      <div class="vgt-ac-desc">Track kills for today's session</div>
      <div class="vgt-ac-status" id="ac-session-status">Inactive</div>
      <div class="vgt-ac-count" id="ac-session-count">Kills: 0</div>
      <div class="vgt-ac-btns">
        <button class="vgt-ac-btn start" id="ac-session-start">Start</button>
        <button class="vgt-ac-btn end" id="ac-session-end" style="display:none;">End</button>
      </div>
    </div>

    <div class="vgt-ac-section">
      <div class="vgt-ac-label">Submissions</div>
      <div class="vgt-ac-desc">Allow players to join queue</div>
      <div class="vgt-ac-status" id="ac-submissions-status">Open</div>
      <button class="vgt-ac-btn toggle" id="ac-toggle-submissions">Close</button>
    </div>

    <div class="vgt-ac-section">
      <div class="vgt-ac-label">World</div>
      <div class="vgt-ac-desc">FC world shown to players</div>
      <input class="vgt-ac-world-input" id="ac-world-input" type="text"
        placeholder="e.g. 36" autocomplete="off" spellcheck="false" />
    </div>
  </div>

  <!-- Completed side panel (admin, left) -->
  <div class="vgt-completed-side-panel" id="completed-side-panel" style="display:none;">
    <div class="vgt-completed-side-header">
      <span>Completed</span>
    </div>
    <input class="vgt-completed-side-search" id="completed-side-search"
      type="text" placeholder="Search..." autocomplete="off" spellcheck="false" />
    <div class="vgt-completed-side-list normalscroll" id="completed-side-list"></div>
  </div>

  <div class="vgt-app">

    <!-- Header -->
    <header class="vgt-header">
      <div class="vgt-title">Vorkath GM Timer</div>
      <div class="vgt-header-right">
        <div class="vgt-world" id="vgt-world"></div>
        <div class="vgt-status-dot" id="vgt-dot" title="Connection status"></div>
        <button class="vgt-admin-btn" id="admin-btn">Admin</button>
      </div>
    </header>

    <!-- Submissions status (visible on all tabs) -->
    <div class="vgt-submissions-status open" id="submissions-status">Submissions open</div>

    <!-- Alt1 install banner (hidden in-app, shown in browser) -->
    <div class="vgt-alt1-banner" id="alt1-banner">
      <span>Not running in Alt1</span>
      <a class="vgt-alt1-install-btn" href="alt1://addapp/https://rssaltea.github.io/vorkath-gm-timer/appconfig.json">Add to Alt1</a>
    </div>

    <!-- Tabs -->
    <div class="vgt-tabs">
      <button class="vgt-tab active" data-tab="info">Info</button>
      <button class="vgt-tab" data-tab="status">Signup</button>
      <button class="vgt-tab" data-tab="queue">Full Queue</button>
    </div>

    <!-- ── STATUS TAB ── -->
    <div class="vgt-page" id="tab-status">

      <div class="vgt-name-card">
        <div class="vgt-label">Your RS Name</div>
        <input
          class="vgt-name-input"
          id="name-override"
          type="text"
          placeholder="Enter your RS name..."
          autocomplete="off"
          spellcheck="false"
        />
      </div>

      <div class="vgt-name-card">
        <div class="vgt-label">Phrase from Info Tab</div>
        <input
          class="vgt-name-input"
          id="info-phrase-input"
          type="text"
          placeholder="Read the Info tab for Phrase..."
          autocomplete="off"
          spellcheck="false"
        />
      </div>

      <div class="vgt-alert-card neutral" id="alert-card">
        <div class="vgt-alert-icon" id="alert-icon">⏳</div>
        <div class="vgt-alert-title" id="alert-title">Checking queue...</div>
        <div class="vgt-alert-sub" id="alert-sub"></div>
      </div>

      <button class="vgt-join-btn" id="join-queue-btn">+ Join Queue</button>

      <div class="vgt-position-card">
        <div class="vgt-label">Your Position</div>
        <div class="vgt-position" id="queue-position">—</div>
      </div>

      <div class="vgt-footer">
        <span id="last-updated">Not yet updated</span>
        <button class="vgt-refresh-btn" id="refresh-btn">↻ Refresh</button>
      </div>

    </div>

    <!-- ── QUEUE TAB ── -->
    <div class="vgt-page" id="tab-queue">

      <div class="vgt-queue-header">
        <div class="vgt-label">Current Queue (<span id="queue-count">0</span>)</div>
        <button class="vgt-refresh-btn" id="refresh-btn-queue">↻ Refresh</button>
      </div>

      <div class="vgt-queue-list normalscroll" id="queue-list">
        <div class="vgt-queue-state">Loading queue...</div>
      </div>

      <div class="vgt-completed-panel">
        <button class="vgt-completed-toggle" id="completed-toggle">Completed &#9656;</button>
        <div class="vgt-completed-body" id="completed-body" style="display:none;">
          <div class="vgt-completed-search-wrap">
            <input class="vgt-name-input" id="completed-search" type="text" placeholder="Search..." autocomplete="off" spellcheck="false" />
            <a class="vgt-completed-fullview" href="completed.html" target="_blank" title="View full list">&#x2197;</a>
            <div class="vgt-completed-suggestions" id="completed-suggestions"></div>
          </div>
          <div class="vgt-completed-list normalscroll" id="completed-list"></div>
        </div>
      </div>

    </div>

    <!-- ── INFO TAB ── -->
    <div class="vgt-page active" id="tab-info">

      <div class="vgt-info-hero">
        <div class="vgt-info-stats">
          <span class="vgt-info-stat" id="info-total">Total: —</span>
          <div class="vgt-info-fc-name">VorkathFC</div>
          <span class="vgt-info-stat" id="info-today">Today: —</span>
        </div>
        <label class="vgt-reminder-toggle">
          <span class="vgt-reminder-label">Reminder Toggle</span>
          <input type="checkbox" id="reminder-toggle" checked />
          <span class="vgt-toggle-track">
            <span class="vgt-toggle-thumb"></span>
          </span>
        </label>
      </div>

      <div class="vgt-info-card">
        <div class="vgt-label">Tips</div>
        <ul class="vgt-info-list">
          <li>Use Necromancy, do not use any other style please.</li>
          <li>Command Ghost active at all times!</li>
          <li>DO NOT PRESS THE BALLISTA BUTTON EVER!</li>
          <li>Stay on the opposite side of Vorkath, away from the carry team. (south)</li>
          <li>Devourer's Nexus (if you have it), Equilibrium aura and Ripper demon.</li>
          <li>Focus as much damage as possible for the Zemouregal skip (when Vorkath flies away). Phrase: dragon fire.</li>
          <li>We encourage you to keep the app (or website) open at all times.</li>
          <li>Join the instance of any carry team members usually:</li>
          <li class="vgt-info-circle"><span style="color:#ff9800">Glotzfrosch</span>, <span style="color:#ff9800">Saltea</span>, <span style="color:#ff9800">Czesc</span> or <span style="color:#ff9800">Nanci</span></li>
          <li>Please only join if you are #1 on the list! If you keep joining when it is not your turn you may be skipped.</li>
        </ul>
      </div>

      <button class="vgt-info-btn vgt-info-btn--discord"
              onclick="window.open('https://discord.gg/vorkath','_blank')">
        <svg class="vgt-discord-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/>
        </svg>
        Join our Discord
      </button>

    </div>

    <!-- Admin login overlay -->
    <div class="vgt-admin-overlay" id="admin-overlay" style="display:none;">
      <div class="vgt-admin-dialog">
        <div class="vgt-label">Calibration</div>
        <input
          class="vgt-name-input"
          id="admin-pass-input"
          type="password"
          placeholder="Enter key..."
          autocomplete="off"
          spellcheck="false"
        />
        <div class="vgt-admin-dialog-btns">
          <button class="vgt-refresh-btn" id="admin-cancel-btn">Cancel</button>
          <button class="vgt-join-btn vgt-admin-login-btn" id="admin-login-btn">Login</button>
        </div>
        <div class="vgt-admin-error" id="admin-error" style="display:none;">Invalid key</div>
      </div>
    </div>

  </div>

  <!-- Info side panel (right of app, visible on Info tab) -->
  <div class="vgt-info-side-panel" id="info-side-panel" style="display:none;">
    <div class="vgt-info-side-content">
      <button class="vgt-info-btn vgt-info-btn--yt"
              onclick="window.open('https://www.youtube.com/watch?v=Ds8aovPQ48I','_blank')">
        ▶&nbsp; Example Kill
      </button>
      <img class="vgt-info-side-img" src="./src/img/stand.png" alt="Stand position" />
    </div>
  </div>

  <!-- Skipped players side panel -->
  <div class="vgt-skipped-panel" id="skipped-panel" style="display:none;">
    <div class="vgt-skipped-header">
      <span>Skipped</span>
    </div>
    <div class="vgt-skipped-list normalscroll" id="skipped-list"></div>
  </div>

  <!-- Admin chat side panel -->
  <div class="vgt-chat-panel" id="chat-panel" style="display:none;">
    <div class="vgt-chat-header">
      <span>Admin Chat</span>
    </div>
    <div class="vgt-chat-input-wrap">
      <input class="vgt-chat-input" id="chat-input"
        type="text" placeholder="Type a message..."
        autocomplete="off" spellcheck="false" maxlength="200" />
      <button class="vgt-chat-send" id="chat-send-btn">Send</button>
    </div>
    <div class="vgt-chat-messages normalscroll" id="chat-messages"></div>
  </div>

  </div>

  <script src="./src/script.js?v=3.25"></script>
  <script src="./src/haunt-detector.js?v=2.2"></script>
  <script src="./src/chat-reader.js?v=2.7"></script>
</body>
</html>
